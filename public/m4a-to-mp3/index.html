<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="description" content="Convert M4A files to MP3 format for free. Convert Apple audio to universal MP3 format.">
    <meta name="keywords" content="audio converter, mp3 converter, wav converter, audio format converter, free audio converter">
    
    <link rel="canonical" href="https://yourdomain.com/m4a-to-mp3/" />
    
    <title>M4A to MP3 Converter - Free Online Audio Converter</title>

    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéµ</text></svg>">

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container { max-width: 1400px; margin: 0 auto; }

        header { text-align: center; color: white; margin-bottom: 30px; padding: 20px 0; }
        h1 { font-size: 2.5rem; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); margin-bottom: 10px; }
        .subtitle { font-size: 1.1rem; opacity: 0.95; }

        /* --- 3-COLUMN LAYOUT --- */
        .main-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            align-items: start;
        }

        @media (min-width: 1024px) {
            .main-content {
                grid-template-columns: 250px 1fr 250px;
            }
        }

        /* --- AD CONTAINERS (PRODUCTION) --- */
        .ad-container {
            background: #f9f9f9;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            border-radius: 8px;
            overflow: hidden;
            min-height: 90px;
            border: none;
        }

        aside { display: none; }
        @media (min-width: 1024px) { aside { display: block !important; } }

        .sidebar-ad {
            width: 100%; height: 600px; 
            background: transparent;
            display: flex; align-items: center; justify-content: center;
            position: sticky; top: 20px;
            border: none;
        }

        #test-top-banner, #ad-banner-1 { width: 100%; min-height: 100px; background: #f9f9f9; display: flex !important; }
        #ad-banner-2 { width: 100%; min-height: 250px; display: none; } 
        #ad-banner-2.active { display: flex; }
        #inlineAd { min-height: 250px; margin: 15px 0; display: none; }
        #inlineAd.active { display: flex; }

        /* --- CONVERTER UI --- */
        .conversion-section {
            background: white; border-radius: 12px; padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1); margin-bottom: 20px;
        }

        .upload-area {
            border: 3px dashed #667eea; border-radius: 8px; padding: 50px 20px;
            text-align: center; transition: all 0.3s ease; cursor: pointer;
            background: #f8f9ff; margin-bottom: 25px;
        }
        .upload-area:hover { background: #f0f2ff; }
        
        .upload-icon { font-size: 3rem; margin-bottom: 15px; }
        
        /* Success Animation */
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .upload-icon.success { animation: bounce 1s infinite; color: #2e7d32; }

        select {
            width: 100%; padding: 12px; border: 2px solid #ddd;
            border-radius: 6px; font-size: 1rem; margin-bottom: 20px;
            background: white; cursor: pointer;
        }

        .convert-btn {
            width: 100%; padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; border: none; border-radius: 8px;
            font-size: 1.1rem; font-weight: 600; cursor: pointer;
            transition: all 0.2s;
        }
        .convert-btn:disabled { opacity: 0.7; cursor: not-allowed; background: #999; }
        
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
        .convert-btn.converting { animation: pulse 1.5s infinite; }

        .progress-container { display: none; margin-bottom: 20px; }
        .progress-container.active { display: block; }
        
        .progress-bar {
            width: 100%; height: 30px; background: #e0e0e0;
            border-radius: 15px; overflow: hidden; margin-bottom: 10px;
        }
        .progress-fill {
            height: 100%; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            display: flex; align-items: center; justify-content: center;
            color: white; font-weight: 600;
        }

        .result-section {
            display: none; background: #e3f2fd; padding: 20px;
            border-radius: 8px; margin-bottom: 20px; text-align: center;
        }
        .result-section.active { display: block; }

        .download-btn {
            width: 100%; padding: 15px; background: #4caf50;
            color: white; border: none; border-radius: 8px;
            font-size: 1.1rem; font-weight: 600; cursor: pointer; margin-bottom: 10px;
        }

        .error-message {
            background: #ffebee; color: #c62828; padding: 15px;
            border-radius: 8px; margin-bottom: 20px; display: none;
        }
        .error-message.active { display: block; }

        input[type="file"] { display: none; }
        .features { margin-top: 30px; background: white; padding: 30px; border-radius: 12px; }
        .feature-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px; }
        .feature-item { background: #f8f9ff; padding: 15px; border-radius: 8px; }
        
        footer { text-align: center; color: white; margin-top: 40px; padding: 20px; opacity: 0.8; }
        
        /* Consent Modal */
        .consent-modal {
            position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 20px;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.2); z-index: 1000; display: none;
        }
        .consent-modal.active { display: block; }
        .consent-content { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
        .consent-btn { padding: 8px 20px; margin-left: 10px; cursor: pointer; border-radius: 4px; border: none; font-weight: bold; }
        .consent-accept { background: #4caf50; color: white; }
    </style>
</head>
<body>
    <div class="consent-modal" id="consentModal">
        <div class="consent-content">
            <div><strong>Cookie Consent:</strong> We use cookies to keep this service free.</div>
            <div><button class="consent-btn consent-accept" onclick="acceptConsent()">Accept</button></div>
        </div>
    </div>

    <div class="container">
        <header>
            <h1>Convert M4A to MP3</h1>
            <p class="subtitle">Convert MP3, WAV, FLAC, AAC, M4A, OGG - Fast & Simple</p>
        </header>

        <div class="main-content">
            <aside id="left-sidebar"><div class="sidebar-ad"></div></aside>

            <div class="conversion-area">
                <div class="ad-container" id="ad-banner-1"></div>

                <div class="conversion-section">
                    <h2 style="margin-bottom: 20px; color: #333;">Upload & Convert</h2>
                    <div class="error-message" id="errorMessage"></div>

                    <div class="upload-area" id="uploadArea">
                        <div class="upload-icon">üìÅ</div>
                        <div class="upload-text">Drag & Drop your audio file here</div>
                        <div style="margin: 15px 0; color: #999;">or</div>
                        <button onclick="document.getElementById('fileInput').click()" style="padding: 10px 30px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;">Browse Files</button>
                        <input type="file" id="fileInput" accept="audio/*,.mp3,.wav,.flac,.aac,.m4a,.ogg,.wma">
                        <div style="margin-top: 15px; color: #999; font-size: 0.9rem;">Max file size: 50MB</div>
                    </div>

                    <div class="format-selection">
                        <label for="outputFormat" style="display:block; margin-bottom:8px; font-weight:600;">Convert to:</label>
                        <select id="outputFormat">
                            <option value="mp3">MP3 (MPEG Audio)</option>
                            <option value="wav">WAV (Waveform Audio)</option>
                            <option value="flac">FLAC (Free Lossless)</option>
                            <option value="aac">AAC (Advanced Audio)</option>
                            <option value="m4a">M4A (MPEG-4 Audio)</option>
                            <option value="ogg">OGG (Ogg Vorbis)</option>
                            <option value="wma">WMA (Windows Media)</option>
                        </select>
                    </div>

                    <button class="convert-btn" id="convertBtn" onclick="startConversion()" disabled>Convert Audio File</button>

                    <div class="progress-container" id="progressContainer">
                        <div class="progress-bar"><div class="progress-fill" id="progressFill">0%</div></div>
                        <div style="text-align: center; color: #666;">Converting...</div>
                        <div class="ad-container" id="inlineAd"></div>
                    </div>

                    <div class="result-section" id="resultSection">
                        <h3 style="color: #1976d2; margin-bottom: 15px;">‚úÖ Conversion Complete!</h3>
                        <div id="downloadContainer"></div>
                        <button class="convert-btn" onclick="location.reload()" style="background: white; color: #667eea; border: 2px solid #667eea; margin-top: 10px;">Convert Another File</button>
                    </div>
                </div>

                <div class="ad-container" id="ad-banner-2"></div>

                <section class="features">
                    <h2>Why Choose Our Converter?</h2>
                    <div class="feature-grid">
                        <div class="feature-item"><h3>üöÄ Fast</h3><p>Optimized server-side conversion.</p></div>
                        <div class="feature-item"><h3>üîí Secure</h3><p>Files auto-deleted immediately.</p></div>
                        <div class="feature-item"><h3>üíØ Free</h3><p>No signup required.</p></div>
                    </div>
                </section>
            </div>

            <aside id="right-sidebar"><div class="sidebar-ad"></div></aside>
        </div>

        <footer>
            <p>&copy; 2025 Free Audio Converter | <a href="/privacy.html" style="color:white;">Privacy Policy</a></p>
        </footer>
    </div>

    <script>
        // --- GLOBAL VARIABLES ---
        let selectedFile = null;
        const errorMessage = document.getElementById('errorMessage');
        const convertBtn = document.getElementById('convertBtn');
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');

        // ‚úÖ AUTO-SELECT FORMAT (From Build Script)
        // If this page is "mp3-to-wav", this will auto-select 'wav'
        const defaultFormat = "mp3";
        if(defaultFormat && defaultFormat !== 'mp3') {
            document.getElementById('outputFormat').value = defaultFormat;
        }

        // --- CONSENT LOGIC ---
        window.addEventListener('DOMContentLoaded', () => {
            if (localStorage.getItem('adsConsent') === null) {
                document.getElementById('consentModal').classList.add('active');
            }
        });
        function acceptConsent() {
            localStorage.setItem('adsConsent', 'true');
            document.getElementById('consentModal').classList.remove('active');
        }
        function declineConsent() {
            document.getElementById('consentModal').classList.remove('active');
        }

        // --- UPLOAD HANDLING ---
        uploadArea.addEventListener('dragover', (e) => { e.preventDefault(); uploadArea.style.borderColor = '#764ba2'; });
        uploadArea.addEventListener('dragleave', () => { uploadArea.style.borderColor = '#667eea'; });
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            if(e.dataTransfer.files.length > 0) handleFileSelect(e.dataTransfer.files[0]);
        });
        fileInput.addEventListener('change', (e) => {
            if(e.target.files.length > 0) handleFileSelect(e.target.files[0]);
        });

        function handleFileSelect(file) {
            errorMessage.classList.remove('active');
            if (file.size > 50 * 1024 * 1024) { showError('‚ùå File too large! Limit is 50MB.'); return; }
            const validExts = ['.mp3', '.wav', '.flac', '.aac', '.m4a', '.ogg', '.wma'];
            const fileExt = '.' + file.name.split('.').pop().toLowerCase();
            if (!validExts.includes(fileExt)) { showError('‚ùå Invalid file type.'); return; }

            selectedFile = file;
            convertBtn.disabled = false;
            uploadArea.style.borderColor = '#4caf50';
            uploadArea.style.background = '#f1f8e9';
            uploadArea.innerHTML = `
                <div class="upload-icon success" style="font-size: 3rem; margin-bottom: 10px;">üéµ</div>
                <h3 style="color: #2e7d32; margin-bottom: 5px; word-break: break-all;">${file.name}</h3>
                <p style="color: #555; margin-bottom: 15px;">${formatSize(file.size)}</p>
                <button onclick="location.reload()" style="padding: 8px 16px; cursor: pointer; background: white; border: 1px solid #ccc; border-radius: 4px;">Change File</button>
            `;
        }

        async function startConversion() {
            if (!selectedFile) return;
            convertBtn.disabled = true;
            convertBtn.textContent = "Uploading & Converting...";
            convertBtn.classList.add('converting');
            
            document.getElementById('progressContainer').classList.add('active');
            document.getElementById('resultSection').classList.remove('active');
            document.getElementById('ad-banner-2').classList.remove('active');
            
            const formData = new FormData();
            formData.append('audioFile', selectedFile);
            formData.append('format', document.getElementById('outputFormat').value);

            const progressFill = document.getElementById('progressFill');
            let w = 0;
            const progInt = setInterval(() => { if(w<90) w+=2; progressFill.style.width = w+'%'; }, 100);

            try {
                const response = await fetch('/convert', { method: 'POST', body: formData });
                if (!response.ok) {
                    const errData = await response.json().catch(() => ({}));
                    throw new Error(errData.message || 'Server Connection Failed');
                }
                const blob = await response.blob();
                clearInterval(progInt);
                progressFill.style.width = '100%';
                convertBtn.classList.remove('converting');
                setTimeout(() => {
                    showDownloadButton(blob, `converted.${document.getElementById('outputFormat').value}`);
                }, 500);
            } catch (error) {
                clearInterval(progInt);
                convertBtn.disabled = false;
                convertBtn.textContent = "Convert Audio File";
                convertBtn.classList.remove('converting');
                showError('‚ùå ' + error.message);
                document.getElementById('progressContainer').classList.remove('active');
            }
        }

        function showDownloadButton(blob, filename) {
            document.getElementById('progressContainer').classList.remove('active');
            document.getElementById('resultSection').classList.add('active');
            document.getElementById('ad-banner-2').classList.add('active');
            const url = window.URL.createObjectURL(blob);
            document.getElementById('downloadContainer').innerHTML = `
                <a href="${url}" download="${filename}" style="text-decoration:none;">
                    <button class="download-btn">‚¨áÔ∏è Download ${filename}</button>
                </a>`;
        }

        function formatSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        function showError(msg) { errorMessage.textContent = msg; errorMessage.classList.add('active'); }
    </script>
</body>
</html>