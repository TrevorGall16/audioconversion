<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Free online audio converter. Convert MP3, WAV, FLAC, AAC, M4A, OGG and more. Fast, simple, no signup required.">
    <meta name="keywords" content="audio converter, mp3 converter, wav converter, audio format converter, free audio converter">
    <title>Free Audio Converter - Convert MP3, WAV, FLAC & More</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px; /* Increased width to fit 3 columns */
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 20px 0;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.95;
        }

        /* --- LAYOUT GRID (The 3-Column Fix) --- */
        .main-content {
            display: grid;
            grid-template-columns: 1fr; /* Default: Mobile Stack */
            gap: 20px;
            align-items: start;
        }

        /* Desktop: Left Sidebar (250px) | Content (Flexible) | Right Sidebar (250px) */
        @media (min-width: 1024px) {
            .main-content {
                grid-template-columns: 250px 1fr 250px;
            }
        }

        /* --- AD CONTAINER STYLES --- */
        .ad-container {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #555;
            font-size: 0.9rem;
            font-weight: bold;
            margin-bottom: 20px;
            overflow: hidden; /* Prevents overflow */
        }

        /* Banner 1 (Top Center) */
        #test-top-banner {
            display: block !important;
            width: 100%;
            height: 100px; /* Fixed height for header banner */
            margin-bottom: 20px;
            border: 3px solid #FF6B6B; /* Red Border for Visibility */
            background: white;
            position: relative;
            z-index: 10;
        }

        /* Banner 2 (Bottom Center) */
        #ad-banner-2 {
            min-height: 250px;
            width: 100%;
            display: none; /* Hidden until conversion */
            border: 3px solid #FFA500; /* Orange Border */
        }
        #ad-banner-2.active { display: flex; }

        /* Inline Ad (Inside Tool) */
        #inlineAd {
            min-height: 100px;
            margin: 15px 0;
            display: none;
            border: 3px solid #9b59b6; /* Purple Border */
        }
        #inlineAd.active { display: flex; }

        /* Sidebars (Left & Right) */
        aside {
            display: none; /* Hidden on Mobile/Tablet */
        }

        @media (min-width: 1024px) {
            aside {
                display: block !important;
            }
        }

        .sidebar-ad {
            width: 100%;
            height: 600px;
            background: white;
            border-radius: 12px;
            border: 3px solid #4ECDC4; /* Cyan Border */
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            position: sticky; /* Keeps it visible while scrolling */
            top: 20px;
        }

        /* --- COMPONENT STYLES --- */
        .conversion-section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 8px;
            padding: 50px 20px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            background: #f8f9ff;
            margin-bottom: 25px;
        }

        .upload-area.drag-over {
            background: #e8ebff;
            border-color: #764ba2;
            transform: scale(1.02);
        }

        .upload-area:hover {
            background: #f0f2ff;
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .file-info {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
        .file-info.active { display: block; }

        .format-selection { margin-bottom: 25px; }
        
        label { display: block; font-weight: 600; margin-bottom: 8px; color: #444; }
        select {
            width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 1rem;
            background: white; cursor: pointer; transition: border-color 0.3s;
        }
        select:focus { outline: none; border-color: #667eea; }

        .convert-btn {
            width: 100%; padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; border: none; border-radius: 8px;
            font-size: 1.1rem; font-weight: 600; cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s; margin-bottom: 20px;
        }
        .convert-btn:disabled { opacity: 0.6; cursor: not-allowed; }

        .progress-container { display: none; margin-bottom: 20px; }
        .progress-container.active { display: block; }
        .progress-bar {
            width: 100%; height: 30px; background: #e0e0e0;
            border-radius: 15px; overflow: hidden; margin-bottom: 10px;
        }
        .progress-fill {
            height: 100%; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%; transition: width 0.3s; display: flex;
            align-items: center; justify-content: center; color: white; font-weight: 600;
        }

        .result-section {
            display: none; background: #e3f2fd; padding: 20px;
            border-radius: 8px; margin-bottom: 20px;
        }
        .result-section.active { display: block; }

        .download-btn {
            width: 100%; padding: 15px; background: #4caf50;
            color: white; border: none; border-radius: 8px;
            font-size: 1.1rem; font-weight: 600; cursor: pointer; margin-bottom: 10px;
        }
        .download-btn:hover { background: #45a049; }

        .convert-again-btn {
            width: 100%; padding: 12px; background: white;
            color: #667eea; border: 2px solid #667eea; border-radius: 8px;
            font-size: 1rem; font-weight: 600; cursor: pointer;
        }

        /* Features Section */
        .features {
            background: white; border-radius: 12px; padding: 30px;
            margin-top: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        .feature-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px; margin-top: 20px;
        }
        .feature-item { padding: 20px; background: #f8f9ff; border-radius: 8px; }
        .feature-item h3 { color: #667eea; margin-bottom: 10px; }

        footer { text-align: center; color: white; margin-top: 40px; padding: 20px; opacity: 0.9; }

        /* Consent Modal */
        .consent-modal {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: white; padding: 20px; box-shadow: 0 -5px 20px rgba(0,0,0,0.2);
            z-index: 1000; display: none;
        }
        .consent-modal.active { display: block; }
        .consent-content {
            max-width: 1200px; margin: 0 auto; display: flex;
            flex-direction: column; gap: 15px;
        }
        @media (min-width: 768px) {
            .consent-content { flex-direction: row; align-items: center; justify-content: space-between; }
        }
        .consent-buttons { display: flex; gap: 10px; }
        .consent-btn { padding: 10px 20px; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; }
        .consent-accept { background: #4caf50; color: white; }
        .consent-decline { background: #f5f5f5; color: #333; }
        
        .error-message {
            background: #ffebee; color: #c62828; padding: 15px;
            border-radius: 8px; margin-bottom: 20px; display: none;
        }
        .error-message.active { display: block; }
        input[type="file"] { display: none; }

    </style>
</head>
<body>
    <div class="consent-modal" id="consentModal">
        <div class="consent-content">
            <div class="consent-text">
                <strong>Cookie Consent:</strong> We use cookies and ads to keep this service free. By clicking "Accept", you consent to our use of cookies and advertisement services.
            </div>
            <div class="consent-buttons">
                <button class="consent-btn consent-accept" onclick="acceptConsent()">Accept</button>
                <button class="consent-btn consent-decline" onclick="declineConsent()">Decline</button>
            </div>
        </div>
    </div>

    <div class="container">
        <header>
            <h1>üéµ Free Audio Converter</h1>
            <p class="subtitle">Convert MP3, WAV, FLAC, AAC, M4A, OGG - Fast & Simple</p>
        </header>

        <div class="main-content">
            
            <aside id="left-sidebar">
                <div class="sidebar-ad">
                    LEFT SIDEBAR AD<br>(300x600)<br>Desktop Only
                </div>
            </aside>

            <div class="conversion-area">
                
                <div class="ad-container" id="test-top-banner">
                    [TOP BANNER AD - 728x90]
                </div>

                <div class="conversion-section">
                    <h2 style="margin-bottom: 20px; color: #333;">Upload & Convert</h2>

                    <div class="error-message" id="errorMessage"></div>

                    <div class="upload-area" id="uploadArea">
                        <div class="upload-icon">üìÅ</div>
                        <div class="upload-text">Drag & Drop your audio file here</div>
                        <div style="margin: 15px 0; color: #999;">or</div>
                        <button style="padding: 10px 30px; background: #667eea; color: white; border: none; border-radius: 6px; font-size: 1rem; cursor: pointer;" onclick="document.getElementById('fileInput').click()">
                            Browse Files
                        </button>
                        <input type="file" id="fileInput" accept="audio/*,.mp3,.wav,.flac,.aac,.m4a,.ogg,.wma">
                        <div style="margin-top: 15px; color: #999; font-size: 0.9rem;">Max file size: 50MB</div>
                    </div>

                    <div class="file-info" id="fileInfo">
                        <strong>Selected file:</strong> <span id="fileName"></span><br>
                        <strong>Size:</strong> <span id="fileSize"></span>
                    </div>

                    <div class="format-selection">
                        <label for="outputFormat">Convert to:</label>
                        <select id="outputFormat">
                            <option value="mp3">MP3 (MPEG Audio)</option>
                            <option value="wav">WAV (Waveform Audio)</option>
                            <option value="flac">FLAC (Free Lossless)</option>
                            <option value="aac">AAC (Advanced Audio)</option>
                            <option value="m4a">M4A (MPEG-4 Audio)</option>
                            <option value="ogg">OGG (Ogg Vorbis)</option>
                            <option value="wma">WMA (Windows Media)</option>
                        </select>
                    </div>

                    <button class="convert-btn" id="convertBtn" onclick="startConversion()" disabled>
                        Convert Audio File
                    </button>

                    <div class="progress-container" id="progressContainer">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill">0%</div>
                        </div>
                        <div style="text-align: center; color: #666;">Converting your file...</div>
                    </div>

                    <div class="ad-container inline-ad" id="inlineAd">
                        [INLINE AD - 300x250]
                    </div>

<div class="result-section" id="resultSection">
                        <h3 style="color: #1976d2; margin-bottom: 15px;">‚úÖ Conversion Complete!</h3>
                        
                        <div id="downloadContainer"></div>

                        <button class="convert-btn" onclick="location.reload()" style="background: white; color: #667eea; border: 2px solid #667eea; margin-top: 10px;">
                            Convert Another File
                        </button>
                    </div>
                </div>

                <div class="ad-container" id="ad-banner-2">
                    [BOTTOM BANNER AD - 728x90]
                </div>

                <section class="features">
                    <h2>Why Choose Our Audio Converter?</h2>
                    <div class="feature-grid">
                        <div class="feature-item">
                            <h3>üöÄ Lightning Fast</h3>
                            <p>Convert your audio files in seconds with our optimized conversion engine.</p>
                        </div>
                        <div class="feature-item">
                            <h3>üîí Secure & Private</h3>
                            <p>Your files are automatically deleted after conversion. We respect your privacy.</p>
                        </div>
                        <div class="feature-item">
                            <h3>üíØ 100% Free</h3>
                            <p>No signup, no registration, no hidden costs. Just upload and convert.</p>
                        </div>
                        <div class="feature-item">
                            <h3>üì± Works Everywhere</h3>
                            <p>Fully responsive design works perfectly on desktop, tablet, and mobile devices.</p>
                        </div>
                    </div>
                </section>
            </div>

            <aside id="right-sidebar">
                <div class="sidebar-ad">
                    RIGHT SIDEBAR AD<br>(300x600)<br>Desktop Only
                </div>
            </aside>
        </div>

        <footer>
            <p>&copy; 2025 Free Audio Converter. All rights reserved.</p>
        </footer>
    </div>

    <script>
        // --- GLOBAL VARIABLES ---
        let selectedFile = null;
        const errorMessage = document.getElementById('errorMessage');
        const convertBtn = document.getElementById('convertBtn');
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');

        // --- CONSENT LOGIC ---
        window.addEventListener('DOMContentLoaded', () => {
            if (localStorage.getItem('adsConsent') === null) {
                document.getElementById('consentModal').classList.add('active');
            }
        });
        function acceptConsent() {
            localStorage.setItem('adsConsent', 'true');
            document.getElementById('consentModal').classList.remove('active');
        }
        // Decline just closes modal (ads won't load in production logic)
        function declineConsent() {
            document.getElementById('consentModal').classList.remove('active');
        }

        // --- UPLOAD HANDLING ---
        uploadArea.addEventListener('dragover', (e) => { e.preventDefault(); uploadArea.style.borderColor = '#764ba2'; });
        uploadArea.addEventListener('dragleave', () => { uploadArea.style.borderColor = '#667eea'; });
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            if(e.dataTransfer.files.length > 0) handleFileSelect(e.dataTransfer.files[0]);
        });
        fileInput.addEventListener('change', (e) => {
            if(e.target.files.length > 0) handleFileSelect(e.target.files[0]);
        });

        // --- HANDLE FILE SELECTION (With Green Success Box) ---
        function handleFileSelect(file) {
            errorMessage.classList.remove('active');

            // 1. Check Size
            if (file.size > 50 * 1024 * 1024) {
                showError('‚ùå File too large! Limit is 50MB.');
                return;
            }

            // 2. Check Type
            const validExts = ['.mp3', '.wav', '.flac', '.aac', '.m4a', '.ogg', '.wma'];
            const fileExt = '.' + file.name.split('.').pop().toLowerCase();
            if (!validExts.includes(fileExt)) {
                showError('‚ùå Invalid file type. Please upload an audio file.');
                return;
            }

            selectedFile = file;
            convertBtn.disabled = false;

            // UI Update: Success State
            uploadArea.style.borderColor = '#4caf50';
            uploadArea.style.background = '#f1f8e9';
            uploadArea.innerHTML = `
                <div class="upload-icon success" style="font-size: 3rem; margin-bottom: 10px;">üéµ</div>
                <h3 style="color: #2e7d32; margin-bottom: 5px; word-break: break-all;">${file.name}</h3>
                <p style="color: #555; margin-bottom: 15px;">${formatSize(file.size)}</p>
                <button onclick="location.reload()" style="padding: 8px 16px; cursor: pointer; background: white; border: 1px solid #ccc; border-radius: 4px;">Change File</button>
            `;
        }

        // --- REAL SERVER CONVERSION ---
        async function startConversion() {
            if (!selectedFile) return;

            // 1. Lock UI & Add Animations
            convertBtn.disabled = true;
            convertBtn.textContent = "Uploading & Converting...";
            convertBtn.classList.add('converting'); // Pulse Animation
            
            // 2. Show Progress UI (and Inline Ad)
            document.getElementById('progressContainer').classList.add('active');
            document.getElementById('resultSection').classList.remove('active');
            document.getElementById('ad-banner-2').classList.remove('active');
            
            const formData = new FormData();
            formData.append('audioFile', selectedFile);
            formData.append('format', document.getElementById('outputFormat').value);

            // 3. Fake Visual Progress (Just for looks)
            const progressFill = document.getElementById('progressFill');
            let w = 0;
            const progInt = setInterval(() => { if(w<90) w+=2; progressFill.style.width = w+'%'; }, 100);

            try {
                // 4. SEND TO SERVER
                const response = await fetch('/convert', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    const errData = await response.json().catch(() => ({}));
                    throw new Error(errData.message || 'Server Connection Failed');
                }

                const blob = await response.blob();
                
                // 5. Success!
                clearInterval(progInt);
                progressFill.style.width = '100%';
                convertBtn.classList.remove('converting'); // Stop Pulse
                
                setTimeout(() => {
                    showDownloadButton(blob, `converted.${document.getElementById('outputFormat').value}`);
                }, 500);

            } catch (error) {
                clearInterval(progInt);
                convertBtn.disabled = false;
                convertBtn.textContent = "Convert Audio File";
                convertBtn.classList.remove('converting'); // Stop Pulse
                showError('‚ùå ' + error.message);
                document.getElementById('progressContainer').classList.remove('active');
            }
        }

        function showDownloadButton(blob, filename) {
            document.getElementById('progressContainer').classList.remove('active');
            document.getElementById('resultSection').classList.add('active');
            document.getElementById('ad-banner-2').classList.add('active'); // Show Bottom Ad
            
            const url = window.URL.createObjectURL(blob);
            const container = document.getElementById('downloadContainer');
            
            container.innerHTML = `
                <a href="${url}" download="${filename}" style="text-decoration:none;">
                    <button class="download-btn">‚¨áÔ∏è Download ${filename}</button>
                </a>
            `;
        }

        function formatSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        function showError(msg) {
            errorMessage.textContent = msg;
            errorMessage.classList.add('active');
        }

        // Helper to reset everything (e.g. "Convert Another File")
        function resetConverter() {
            location.reload(); // Simplest way to clear file inputs and UI state
        }
        
        // Helper for "Change File" button inside the Green Box
        function resetUI() {
            location.reload();
        }
    </script>