<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="{{DESCRIPTION}}">
    <meta name="keywords" content="audio converter, mp3 converter, wav converter, audio format converter, free audio converter">
    <link rel="canonical" href="{{CANONICAL_URL}}">
    <title>{{TITLE}}</title>
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />
    <meta name="apple-mobile-web-app-title" content="AudioConverter" />
    <meta name="google-site-verification" content="6-KQgsyvigvOEMKCs9VP4Byh0hMKej1CLRlowGGJtmc" />

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f8f9fa;
            background-image: radial-gradient(circle at 20% 30%, rgba(120, 119, 198, 0.05) 0%, transparent 50%),
                              radial-gradient(circle at 80% 70%, rgba(138, 43, 226, 0.04) 0%, transparent 50%);
            min-height: 100vh;
            padding: 40px 20px 60px;
            color: #1e293b;
            letter-spacing: -0.025em;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 48px;
            padding: 0;
        }

        header a {
            text-decoration: none;
            color: inherit;
            display: inline-block;
            transition: opacity 0.2s ease;
        }

        header a:hover {
            opacity: 0.8;
        }

        h1 {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 12px;
            color: #0f172a;
            letter-spacing: -0.04em;
            line-height: 1.1;
        }

        .subtitle {
            font-size: 1.25rem;
            color: #64748b;
            font-weight: 400;
            letter-spacing: -0.02em;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 32px;
        }

        @media (min-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr 340px;
            }
        }

        .conversion-section {
            background: white;
            border-radius: 24px;
            padding: 48px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05), 0 20px 40px rgba(0,0,0,0.03);
            border: 1px solid rgba(226, 232, 240, 0.8);
        }

        .conversion-section h2 {
            margin-bottom: 32px;
            color: #0f172a;
            font-size: 1.75rem;
            font-weight: 700;
            letter-spacing: -0.03em;
        }

        .upload-area {
            border: 2px dashed #cbd5e1;
            border-radius: 24px;
            padding: 64px 32px;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            background: #f8fafc;
            margin-bottom: 32px;
        }

        .upload-area.drag-over {
            background: #f1f5f9;
            border-color: #64748b;
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.06);
        }

        .upload-area:hover {
            background: #f1f5f9;
            border-color: #94a3b8;
        }

        .upload-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.6;
        }

        .upload-text {
            font-size: 1.25rem;
            color: #475569;
            margin-bottom: 12px;
            font-weight: 500;
        }

        .browse-btn {
            padding: 14px 32px;
            background: #0f172a;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.05rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(15, 23, 42, 0.12);
            margin: 16px 0;
        }

        .browse-btn:hover {
            background: #1e293b;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(15, 23, 42, 0.18);
        }

        .file-info {
            background: #f1f5f9;
            padding: 20px 24px;
            border-radius: 16px;
            margin-bottom: 28px;
            display: none;
            border: 1px solid #e2e8f0;
            font-size: 0.95rem;
            color: #475569;
        }

        .file-info.active {
            display: block;
        }

        .format-selection {
            margin-bottom: 32px;
        }

        .format-selection label {
            display: block;
            font-weight: 600;
            margin-bottom: 12px;
            color: #1e293b;
            font-size: 1.1rem;
            letter-spacing: -0.02em;
        }

        .format-selection select {
            width: 100%;
            padding: 16px 20px;
            font-size: 1.05rem;
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #1e293b;
            font-weight: 500;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%2364748b' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            background-size: 20px;
            padding-right: 48px;
        }

        .format-selection select:focus {
            outline: none;
            border-color: #94a3b8;
            box-shadow: 0 0 0 3px rgba(148, 163, 184, 0.1);
        }

        .format-selection select:hover {
            border-color: #cbd5e1;
        }

        .convert-btn {
            width: 100%;
            padding: 18px 32px;
            background: #0f172a;
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 1.15rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 12px rgba(15, 23, 42, 0.15);
        }

        .convert-btn:hover:not(:disabled) {
            background: #1e293b;
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(15, 23, 42, 0.2);
        }

        .convert-btn:disabled {
            background: #cbd5e1;
            cursor: not-allowed;
            box-shadow: none;
        }

        .progress-container {
            margin: 24px 0;
            display: none;
        }

        .progress-container.active {
            display: block;
        }

        .progress-bar {
            width: 100%;
            height: 48px;
            background: #f1f5f9;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            border: 1px solid #e2e8f0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #0f172a 0%, #1e293b 100%);
            width: 0%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1.05rem;
        }

        .result-section {
            display: none;
            margin-top: 28px;
        }

        .result-section.active {
            display: block;
        }

        .result-card {
            background: #f8fef9;
            padding: 28px;
            border-radius: 16px;
            text-align: center;
            border: 2px solid #86efac;
        }

        .success-icon {
            font-size: 3.5rem;
            margin-bottom: 16px;
        }

        .result-text {
            font-size: 1.25rem;
            color: #166534;
            margin-bottom: 24px;
            font-weight: 600;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .action-buttons button {
            flex: 1;
            min-width: 140px;
            padding: 14px 24px;
            border: none;
            border-radius: 12px;
            font-size: 1.05rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .download-btn {
            background: #166534;
            color: white;
        }

        .download-btn:hover {
            background: #15803d;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(22, 101, 52, 0.25);
        }

        .new-conversion-btn {
            background: white;
            color: #0f172a;
            border: 2px solid #e2e8f0;
        }

        .new-conversion-btn:hover {
            background: #f8f9fa;
            border-color: #cbd5e1;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .info-card {
            background: white;
            border-radius: 20px;
            padding: 32px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05), 0 10px 20px rgba(0,0,0,0.02);
            border: 1px solid rgba(226, 232, 240, 0.8);
        }

        .info-card h3 {
            font-size: 1.4rem;
            margin-bottom: 20px;
            color: #0f172a;
            font-weight: 700;
            letter-spacing: -0.025em;
        }

        .feature-list {
            list-style: none;
        }

        .feature-list li {
            padding: 14px 0;
            border-bottom: 1px solid #f1f5f9;
            color: #475569;
            font-size: 1rem;
            line-height: 1.6;
        }

        .feature-list li:last-child {
            border-bottom: none;
        }

        .feature-list li::before {
            content: "âœ“";
            color: #22c55e;
            font-weight: bold;
            margin-right: 12px;
            font-size: 1.2rem;
        }

        .nav-links {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 8px;
        }

        .nav-links a {
            color: #64748b;
            text-decoration: none;
            font-size: 0.95rem;
            transition: color 0.2s ease;
            font-weight: 500;
        }

        .nav-links a:hover {
            color: #0f172a;
        }

        .error-message {
            background: #fef2f2;
            border: 2px solid #fca5a5;
            color: #991b1b;
            padding: 16px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: none;
            font-weight: 500;
        }

        .error-message.active {
            display: block;
        }

        footer {
            max-width: 1280px;
            margin: 60px auto 0;
            padding: 32px 20px;
            text-align: center;
            color: #64748b;
            font-size: 0.9rem;
        }

        .content-section {
            background: white;
            border-radius: 24px;
            padding: 48px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05), 0 20px 40px rgba(0,0,0,0.03);
            border: 1px solid rgba(226, 232, 240, 0.8);
            margin-bottom: 32px;
        }

        .content-section h2 {
            font-size: 1.75rem;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 24px;
            letter-spacing: -0.03em;
        }

        .content-section h3 {
            font-size: 1.35rem;
            font-weight: 600;
            color: #1e293b;
            margin-top: 32px;
            margin-bottom: 16px;
            letter-spacing: -0.02em;
        }

        .content-section p {
            font-size: 1.05rem;
            line-height: 1.8;
            color: #475569;
            margin-bottom: 20px;
        }

        .content-section ul {
            margin: 20px 0;
            padding-left: 28px;
        }

        .content-section li {
            font-size: 1.05rem;
            line-height: 1.8;
            color: #475569;
            margin-bottom: 12px;
        }

        .conversion-section .content-section p {
            font-size: 1.05rem !important;
            line-height: 1.8 !important;
            color: #475569 !important;
            margin-bottom: 20px !important;
        }

        .conversion-section .content-section h2 {
            font-size: 1.75rem !important;
            font-weight: 700 !important;
            color: #0f172a !important;
            margin-bottom: 24px !important;
        }

        .conversion-section .content-section h3 {
            font-size: 1.35rem !important;
            font-weight: 600 !important;
            color: #1e293b !important;
            margin-top: 32px !important;
            margin-bottom: 16px !important;
        }

        .conversion-section .content-section ul {
            margin: 20px 0 !important;
            padding-left: 28px !important;
        }

        .conversion-section .content-section li {
            font-size: 1.05rem !important;
            line-height: 1.8 !important;
            color: #475569 !important;
            margin-bottom: 12px !important;
        }

        .ad-container {
            background: #f8f9fa;
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            border: 1px solid #e2e8f0;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ad-container.hidden {
            display: none;
        }

        .inline-ad {
            margin: 32px 0;
            display: none;
        }

        .inline-ad.active {
            display: block;
        }

        #ad-banner-2 {
            margin-top: 28px;
            display: none;
        }

        #ad-banner-2.active {
            display: block;
        }

        @media (max-width: 768px) {
            body {
                padding: 24px 16px 40px;
            }

            h1 {
                font-size: 2.5rem;
            }

            .subtitle {
                font-size: 1.1rem;
            }

            .conversion-section, .info-card, .content-section {
                padding: 32px 24px;
            }

            .upload-area {
                padding: 48px 20px;
            }

            .action-buttons {
                flex-direction: column;
            }

            .action-buttons button {
                width: 100%;
            }
        }

        .consent-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: 20px;
        }

        .consent-overlay.hidden {
            display: none;
        }

        .consent-modal {
            background: white;
            border-radius: 24px;
            padding: 40px;
            max-width: 560px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .consent-modal h2 {
            font-size: 1.6rem;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 20px;
        }

        .consent-modal p {
            font-size: 1.05rem;
            line-height: 1.7;
            color: #475569;
            margin-bottom: 24px;
        }

        .consent-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .consent-buttons button {
            flex: 1;
            padding: 14px 24px;
            border: none;
            border-radius: 12px;
            font-size: 1.05rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 120px;
        }

        .consent-accept {
            background: #0f172a;
            color: white;
        }

        .consent-accept:hover {
            background: #1e293b;
        }

        .consent-decline {
            background: #f1f5f9;
            color: #475569;
        }

        .consent-decline:hover {
            background: #e2e8f0;
        }

        /* Educational content section styling */
        .educational-content {
            background: white;
            border-radius: 24px;
            padding: 48px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05), 0 20px 40px rgba(0,0,0,0.03);
            border: 1px solid rgba(226, 232, 240, 0.8);
            margin-top: 32px;
        }

        .educational-content h2 {
            font-size: 1.75rem;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 24px;
            letter-spacing: -0.03em;
        }

        .educational-content h3 {
            font-size: 1.35rem;
            font-weight: 600;
            color: #1e293b;
            margin-top: 28px;
            margin-bottom: 16px;
            letter-spacing: -0.02em;
        }

        .educational-content p {
            font-size: 1.05rem;
            line-height: 1.8;
            color: #475569;
            margin-bottom: 20px;
        }

        .educational-content ul {
            margin: 20px 0;
            padding-left: 28px;
        }

        .educational-content li {
            font-size: 1.05rem;
            line-height: 1.8;
            color: #475569;
            margin-bottom: 12px;
        }

        .use-case-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 24px 0;
        }

        .use-case-card {
            background: #f8fafc;
            border-radius: 16px;
            padding: 24px;
            border: 1px solid #e2e8f0;
        }

        .use-case-card h4 {
            font-size: 1.15rem;
            font-weight: 600;
            color: #0f172a;
            margin-bottom: 12px;
        }

        .use-case-card p {
            font-size: 0.98rem;
            line-height: 1.7;
            color: #64748b;
            margin-bottom: 0;
        }

        @media (max-width: 768px) {
            .educational-content {
                padding: 32px 24px;
            }
            
            .use-case-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="consent-overlay" id="consentOverlay">
        <div class="consent-modal">
            <h2>Privacy & Cookie Consent</h2>
            <p>We use cookies and display ads to keep this service free. By accepting, you consent to personalized ads. You can decline and use the converter without ads.</p>
            <div class="consent-buttons">
                <button class="consent-accept" onclick="acceptConsent()">Accept & Continue</button>
                <button class="consent-decline" onclick="declineConsent()">Decline Ads</button>
            </div>
        </div>
    </div>

    <div class="container">
        <header>
            <a href="/">
                <h1>ðŸŽµ Free Audio Converter</h1>
                <p class="subtitle">Fast, Private, Browser-Based Audio Format Conversion</p>
            </a>
        </header>

        <div class="nav-links">
            <a href="/">Home</a>
            <a href="/audio-formats">Audio Formats Guide</a>
            <a href="/privacy">Privacy Policy</a>
            <a href="/faq">FAQ</a>
        </div>

        <div class="main-content">
            <div>
                <div class="conversion-section">
                    {{CONTENT}}
                </div>

                <div class="educational-content">
                    <h2>Understanding Audio Format Conversion</h2>
                    
                    <p>Audio format conversion is the process of transforming audio files from one codec or container format to another. This process is essential for ensuring compatibility across different devices, applications, and use cases. Whether you're a podcaster preparing content for distribution, a musician sharing demos, or simply organizing your personal music library, understanding audio conversion helps you make informed decisions about quality, file size, and compatibility.</p>

                    <h3>Why Convert Audio Formats?</h3>
                    <p>Different audio formats serve different purposes. Lossless formats like FLAC and WAV preserve every detail of the original recording, making them ideal for archival purposes and professional audio work. However, they create large files that consume significant storage space. Compressed formats like MP3 and AAC reduce file sizes dramatically through perceptual coding, removing audio information that human ears typically cannot detect. This makes them perfect for portable devices and streaming applications where storage and bandwidth are limited.</p>

                    <h3>Common Audio Conversion Scenarios</h3>
                    <div class="use-case-grid">
                        <div class="use-case-card">
                            <h4>Podcast Production</h4>
                            <p>Podcasters typically record in high-quality WAV format but convert to MP3 (128-192 kbps) for distribution. This balances audio quality with file size, ensuring listeners can download episodes quickly without sacrificing clarity of spoken content.</p>
                        </div>
                        <div class="use-case-card">
                            <h4>Music Archiving</h4>
                            <p>Audiophiles and music collectors often convert CD audio to FLAC format, which compresses files by 40-50% without any quality loss. This preserves the original recording while saving storage space compared to uncompressed WAV files.</p>
                        </div>
                        <div class="use-case-card">
                            <h4>Device Compatibility</h4>
                            <p>Older car stereos and MP3 players may not support modern formats like M4A or OGG. Converting these files to MP3 ensures your entire audio library plays seamlessly on any device, regardless of age or manufacturer.</p>
                        </div>
                        <div class="use-case-card">
                            <h4>File Size Reduction</h4>
                            <p>When email attachments or cloud storage limits are a concern, converting high-quality audio to smaller formats becomes necessary. A 40MB WAV file can become a 4MB MP3 file while maintaining acceptable quality for most listening situations.</p>
                        </div>
                    </div>

                    <h3>Quality Considerations</h3>
                    <p>When converting between audio formats, understanding the concept of lossy versus lossless compression is crucial. Lossless formats (FLAC, ALAC, WAV) preserve the original audio data completely, allowing you to convert back and forth without degradation. Lossy formats (MP3, AAC, OGG) permanently discard some audio information to achieve smaller file sizes. Converting from one lossy format to another compounds quality loss, so it's best to keep original high-quality versions when possible.</p>

                    <p>Bitrate selection significantly impacts both quality and file size. For music, 320 kbps MP3 is considered transparent to most listeners, meaning it's indistinguishable from the original. For spoken content like podcasts or audiobooks, 96-128 kbps provides excellent clarity while minimizing file size. Voice-only recordings can use even lower bitrates (64 kbps) without noticeable quality degradation.</p>

                    <h3>Technical Insights: How Conversion Works</h3>
                    <p>Audio conversion involves decoding the source format into raw audio data (PCM samples), then encoding it into the target format using the selected codec. Modern converters like this one use FFmpeg, an industry-standard multimedia framework that supports virtually every audio format. The conversion process preserves metadata like artist names, album titles, and embedded artwork when the target format supports such information.</p>

                    <p>Sample rate and bit depth are fundamental properties that define audio quality. CD-quality audio uses 44.1 kHz sample rate and 16-bit depth. Higher rates (96 kHz, 192 kHz) and depths (24-bit) capture more audio information but create proportionally larger files. Most conversion tools automatically match the source file's properties or allow you to specify these parameters for precise control over the output.</p>

                    <h3>Privacy and Security</h3>
                    <p>Online audio converters vary significantly in how they handle your files. Browser-based converters that process files locally (client-side) offer maximum privacy because your audio never leaves your device. Server-based converters upload files for processing, which may pose privacy concerns for sensitive content. This tool processes conversions on our server but immediately deletes files after conversion, ensuring your audio content remains private and secure.</p>

                    <h3>Best Practices for Audio Conversion</h3>
                    <p>Always keep your original high-quality source files archived. Converting creates a copy in the new format, leaving your original intact. This allows you to create different versions for different purposes without re-ripping or re-recording. For example, maintain FLAC versions at home while creating MP3 versions for portable devices.</p>

                    <p>Match your format to your use case. Use lossless formats for editing, archival, and critical listening. Use lossy formats for everyday listening, sharing, and storage-constrained situations. Consider OGG Vorbis or Opus for streaming applications, as they offer better quality-to-bitrate ratios than MP3. AAC provides excellent quality for Apple ecosystem devices and modern applications.</p>
                </div>
            </div>

            <aside class="sidebar">
                <div class="info-card">
                    <h3>âœ¨ Key Features</h3>
                    <ul class="feature-list">
                        <li>Convert between 10+ popular audio formats instantly</li>
                        <li>No file uploads required - your privacy is protected</li>
                        <li>Works entirely in your browser - fast and secure</li>
                        <li>No registration, downloads, or hidden fees</li>
                        <li>Support for files up to 50MB in size</li>
                    </ul>
                </div>

                <div class="ad-container" id="ad-sidebar">
                    </div>
            </aside>
        </div>
    </div>

    <footer>
        <div class="nav-links" style="justify-content: center; margin-bottom: 16px;">
            <a href="/">Home</a>
            <a href="/audio-formats">Audio Formats</a>
            <a href="/privacy">Privacy</a>
            <a href="/faq">FAQ</a>
        </div>
        <p>&copy; 2024 Free Audio Converter. Fast, private audio conversion tool.</p>
    </footer>

    <script>
        let selectedFile = null;
        let convertedFileUrl = null;
        let adsConsent = false;

        function acceptConsent() {
            adsConsent = true;
            localStorage.setItem('adsConsent', 'true');
            document.getElementById('consentOverlay').classList.add('hidden');
            loadAds();
        }

        function declineConsent() {
            adsConsent = false;
            localStorage.setItem('adsConsent', 'false');
            document.getElementById('consentOverlay').classList.add('hidden');
            document.getElementById('ad-sidebar').classList.add('hidden');
        }

        function loadAds() {
            const script = document.createElement('script');
            script.src = "https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5169811995541557";
            script.async = true;
            script.crossOrigin = "anonymous";
            document.head.appendChild(script);

            script.onload = () => {
                const sidebarAd = document.createElement('ins');
                sidebarAd.className = 'adsbygoogle';
                sidebarAd.style.display = 'block';
                sidebarAd.setAttribute('data-ad-client', 'ca-pub-5169811995541557');
                sidebarAd.setAttribute('data-ad-slot', '1234567890');
                sidebarAd.setAttribute('data-ad-format', 'auto');
                sidebarAd.setAttribute('data-full-width-responsive', 'true');
                document.getElementById('ad-sidebar').appendChild(sidebarAd);
                (adsbygoogle = window.adsbygoogle || []).push({});
            };
        }

        window.addEventListener('DOMContentLoaded', () => {
            const consent = localStorage.getItem('adsConsent');
            if (consent === 'true') {
                adsConsent = true;
                document.getElementById('consentOverlay').classList.add('hidden');
                loadAds();
            } else if (consent === 'false') {
                adsConsent = false;
                document.getElementById('consentOverlay').classList.add('hidden');
                document.getElementById('ad-sidebar').classList.add('hidden');
            }
        });

        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const fileInfo = document.getElementById('fileInfo');
        const convertBtn = document.getElementById('convertBtn');
        const errorMessage = document.getElementById('errorMessage');

        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('drag-over');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('drag-over');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('drag-over');

            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        function handleFile(file) {
            // Validate file size (50MB limit)
            const maxSize = 50 * 1024 * 1024; // 50MB in bytes
            if (file.size > maxSize) {
                errorMessage.textContent = 'âŒ File too large! Maximum size is 50MB.';
                errorMessage.classList.add('active');
                return;
            }

            selectedFile = file;
            document.getElementById('fileName').textContent = file.name;
            document.getElementById('fileSize').textContent = formatFileSize(file.size);
            fileInfo.classList.add('active');
            convertBtn.disabled = false;
            errorMessage.classList.remove('active');
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        // Utility function: delay for retry logic
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Attempt conversion with single retry on network failure
        async function attemptConversion(formData) {
            let retryCount = 0;

            while (retryCount <= 1) {
                try {
                    // Attempt fetch request
                    const response = await fetch('/convert', {
                        method: 'POST',
                        body: formData
                    });

                    // Check if server responded with error (non-2xx)
                    if (!response.ok) {
                        // Server responded but conversion failed - do NOT retry
                        let errorMsg = 'Conversion failed';
                        try {
                            const errorData = await response.json();
                            errorMsg = errorData.message || errorMsg;
                        } catch (e) {
                            // Failed to parse error response
                        }
                        throw new Error(errorMsg);
                    }

                    // Success - return response
                    return response;

                } catch (error) {
                    // Check if this is a network error (fetch promise rejection)
                    // vs a thrown error from response.ok check
                    const isNetworkError = error.message === 'Failed to fetch' ||
                                          error.name === 'TypeError' ||
                                          !error.message.includes('failed');

                    if (isNetworkError && retryCount === 0) {
                        // Network failure on first attempt - wait and retry
                        console.warn('Network error detected, retrying in 2 seconds...');
                        await delay(2000);
                        retryCount++;
                        continue; // Retry the fetch
                    }

                    // Either not a network error, or already retried - throw error
                    if (isNetworkError) {
                        throw new Error('Server Connection Failed');
                    } else {
                        throw error; // Re-throw conversion error
                    }
                }
            }
        }

        async function startConversion() {
            if (!selectedFile) return;

            convertBtn.disabled = true;
            document.getElementById('progressContainer').classList.add('active');
            document.getElementById('resultSection').classList.remove('active');
            document.getElementById('ad-banner-2').classList.remove('active');
            errorMessage.classList.remove('active');

            if (adsConsent) {
                document.getElementById('inlineAd').classList.add('active');
            }

            // Prepare form data
            const formData = new FormData();
            formData.append('audioFile', selectedFile);
            formData.append('format', document.getElementById('outputFormat').value);

            try {
                updateProgress(10);

                // Attempt conversion with retry logic
                const response = await attemptConversion(formData);

                updateProgress(90);

                // Get the converted file
                const blob = await response.blob();
                convertedFileUrl = URL.createObjectURL(blob);

                updateProgress(100);

                setTimeout(() => {
                    completeConversion();
                }, 500);

            } catch (error) {
                console.error('Conversion error:', error);

                // Show clear error message to user
                if (error.message === 'Server Connection Failed') {
                    errorMessage.textContent = 'âŒ Server Connection Failed - Please check your connection and try again';
                } else {
                    errorMessage.textContent = 'âŒ ' + error.message;
                }

                errorMessage.classList.add('active');
                resetConverter();
            }
        }

        function updateProgress(percent) {
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = percent + '%';
            progressFill.textContent = Math.round(percent) + '%';
        }

        function completeConversion() {
            document.getElementById('progressContainer').classList.remove('active');
            document.getElementById('resultSection').classList.add('active');

            if (adsConsent) {
                document.getElementById('ad-banner-2').classList.add('active');
            }
        }

        function downloadFile() {
            if (!convertedFileUrl) return;

            const outputFormat = document.getElementById('outputFormat').value;

            // Extract original filename without extension
            const originalName = selectedFile.name;
            const lastDotIndex = originalName.lastIndexOf('.');
            const nameWithoutExt = lastDotIndex > 0 ? originalName.substring(0, lastDotIndex) : originalName;

            // Sanitize filename (remove special characters, keep alphanumeric, spaces, hyphens, underscores)
            const sanitized = nameWithoutExt.replace(/[^a-zA-Z0-9\s\-_]/g, '').trim();

            // Create download with new naming format
            const a = document.createElement('a');
            a.href = convertedFileUrl;
            a.download = `${sanitized}_convertaudiofast.${outputFormat}`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        function resetConverter() {
            selectedFile = null;
            if (convertedFileUrl) {
                URL.revokeObjectURL(convertedFileUrl);
                convertedFileUrl = null;
            }
            fileInput.value = '';
            fileInfo.classList.remove('active');
            document.getElementById('progressContainer').classList.remove('active');
            document.getElementById('resultSection').classList.remove('active');
            document.getElementById('ad-banner-2').classList.remove('active');
            document.getElementById('inlineAd').classList.remove('active');
            errorMessage.classList.remove('active');
            convertBtn.disabled = true;
            updateProgress(0);
        }
    </script>
</body>
</html>